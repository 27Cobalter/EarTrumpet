<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:actions="clr-namespace:EarTrumpet_Actions.DataModel.Actions"
                    xmlns:avm="clr-namespace:EarTrumpet_Actions.ViewModel.Actions"
                    xmlns:conditions="clr-namespace:EarTrumpet_Actions.DataModel.Conditions"
                    xmlns:conv="clr-namespace:EarTrumpet.UI.Converters;assembly=EarTrumpet"
                    xmlns:ctl="clr-namespace:EarTrumpet.UI.Controls;assembly=EarTrumpet"
                    xmlns:cvm="clr-namespace:EarTrumpet_Actions.ViewModel.Conditions"
                    xmlns:dm="clr-namespace:EarTrumpet_Actions.DataModel"
                    xmlns:etctl="clr-namespace:EarTrumpet_Actions.Controls"
                    xmlns:local="clr-namespace:EarTrumpet_Actions"
                    xmlns:resx="clr-namespace:EarTrumpet_Actions.Properties"
                    xmlns:svc="clr-namespace:EarTrumpet.UI.Services;assembly=EarTrumpet"
                    xmlns:tvm="clr-namespace:EarTrumpet_Actions.ViewModel.Triggers"
                    xmlns:vm="clr-namespace:EarTrumpet_Actions.ViewModel">

    <conv:InvertableVisibilityConverter x:Key="addonVisConverter" />

    <Popup x:Key="ActionsPopup"
           MinWidth="200"
           AllowsTransparency="False"
           Placement="Right"
           PopupAnimation="None">

        <Border x:Name="SubmenuBorder"
                Background="{DynamicResource ContextMenuBackground}"
                BorderBrush="{DynamicResource ContextMenuBorder}"
                BorderThickness="1"
                SnapsToDevicePixels="True">
            <Grid>
                <ContentControl Content="{Binding}" />
            </Grid>
        </Border>
    </Popup>

    <DataTemplate DataType="{x:Type dm:Option}">
        <TextBlock VerticalAlignment="Center" Text="{Binding DisplayName}" />
    </DataTemplate>

    <DataTemplate x:Key="PartMenuItemTemplate">
        <ContentControl VerticalAlignment="Center" Content="{Binding Description}" />
    </DataTemplate>

    <DataTemplate x:Key="PartListItemTemplate">
        <Grid Margin="12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <Button Grid.Column="1"
                    Width="80"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    Command="{Binding Remove}"
                    CommandParameter="{Binding}"
                    Content="-" />

            <etctl:LinkedTextBlock HorizontalAlignment="Left"
                                   VerticalAlignment="Center"
                                   FormatText="{Binding CurrentDescription}" />
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="AddPartItemTemplate">
        <Grid>
            <Button Background="Transparent"
                    BorderThickness="0"
                    Command="{Binding RelativeSource={RelativeSource AncestorType=ListView}, Path=DataContext.Select}"
                    CommandParameter="{Binding}" />
            <TextBlock Margin="12"
                       IsHitTestVisible="False"
                       Text="{Binding Description}" />
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:AddNewPartViewModel}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <ListView ItemTemplate="{StaticResource AddPartItemTemplate}"
                      ItemsSource="{Binding Triggers}"
                      Style="{DynamicResource SettingsListView}" />
            <ListView Grid.Row="1"
                      ItemTemplate="{StaticResource AddPartItemTemplate}"
                      ItemsSource="{Binding Conditions}"
                      Style="{DynamicResource SettingsListView}" />
            <ListView Grid.Row="2"
                      ItemTemplate="{StaticResource AddPartItemTemplate}"
                      ItemsSource="{Binding Actions}"
                      Style="{DynamicResource SettingsListView}" />
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:EarTrumpetActionViewModel}">
        <Grid MinWidth="400"
              MinHeight="400"
              Margin="12">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>


            <TextBox FontSize="24" Text="{Binding DisplayName, Mode=TwoWay}" />

            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock FontSize="20" Text="Triggers" />

                <Button Grid.Column="1"
                        HorizontalAlignment="Right"
                        Command="{Binding AddTrigger}"
                        Style="{DynamicResource AddButtonStyle}" />
            </Grid>

            <ListView Grid.Row="2"
                      IsSynchronizedWithCurrentItem="True"
                      ItemTemplate="{StaticResource PartListItemTemplate}"
                      ItemsSource="{Binding Triggers}"
                      Style="{DynamicResource SettingsListView}" />

            <Grid Grid.Row="3">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock FontSize="20" Text="Filters" />

                <Button Grid.Column="1"
                        HorizontalAlignment="Right"
                        Command="{Binding AddCondition}"
                        Style="{DynamicResource AddButtonStyle}" />
            </Grid>

            <ListView Grid.Row="4"
                      IsSynchronizedWithCurrentItem="True"
                      ItemTemplate="{StaticResource PartListItemTemplate}"
                      ItemsSource="{Binding Conditions}"
                      Style="{DynamicResource SettingsListView}" />

            <Grid Grid.Row="5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock FontSize="20" Text="Actions" />

                <Button Grid.Column="1"
                        HorizontalAlignment="Right"
                        Command="{Binding AddAction}"
                        Style="{DynamicResource AddButtonStyle}" />
            </Grid>

            <ListView Grid.Row="6"
                      IsSynchronizedWithCurrentItem="True"
                      ItemTemplate="{StaticResource PartListItemTemplate}"
                      ItemsSource="{Binding Actions}"
                      Style="{DynamicResource SettingsListView}" />

            <Grid Grid.Row="7">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Button Grid.Column="1"
                        Margin="0,12,0,0"
                        HorizontalAlignment="Right"
                        Command="{Binding Save}"
                        Content="Save"
                        IsEnabled="False" />
            </Grid>


        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:ActionsEditorViewModel}">
        <StackPanel MinWidth="400"
                    MinHeight="400"
                    Margin="12"
                    Orientation="Vertical">
            <TextBlock Margin="6"
                       Style="{DynamicResource HeadingText}"
                       Text="{x:Static resx:Resources.MyActionsText}" />
            <ListView ItemsSource="{Binding Actions}"
                      SelectedItem="{Binding SelectedAction, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                      SelectionMode="Single"
                      Style="{DynamicResource SettingsListView}">
                <ListView.ItemTemplate>
                    <DataTemplate DataType="{x:Type vm:EarTrumpetActionViewModel}">
                        <Grid Margin="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <Button Grid.Row="1"
                                    Grid.Column="1"
                                    Command="{Binding Open}"
                                    Content="{x:Static resx:Resources.EditText}"
                                    Visibility="{Binding IsExpanded, Converter={StaticResource visConverter}, ConverterParameter=Normal}" />

                            <Button Grid.Row="1"
                                    Grid.Column="2"
                                    Command="{Binding Remove}"
                                    Content="{x:Static resx:Resources.RemoveText}"
                                    Visibility="{Binding IsExpanded, Converter={StaticResource visConverter}, ConverterParameter=Normal}" />

                            <TextBlock VerticalAlignment="Center" Text="{Binding DisplayName}" />
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
            <Button Margin="0,6,0,0"
                    Command="{Binding New}"
                    Content="{x:Static resx:Resources.NewActionText}"
                    Style="{DynamicResource AddButtonStyle}" />
        </StackPanel>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:VolumeViewModel}">
        <ctl:VolumeSlider Maximum="100"
                          Minimum="0"
                          Style="{StaticResource {x:Type Slider}}"
                          Value="{Binding Volume, Mode=TwoWay}" />
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:AppViewModel}">
        <ComboBox IsSynchronizedWithCurrentItem="True"
                  ItemsSource="{Binding All}"
                  SelectedItem="{Binding Selected, Mode=TwoWay}" />
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:DeviceViewModel}">
        <ComboBox IsSynchronizedWithCurrentItem="True"
                  ItemsSource="{Binding All}"
                  SelectedItem="{Binding Selected, Mode=TwoWay}" />
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:OptionViewModel}">
        <ComboBox IsSynchronizedWithCurrentItem="True"
                  ItemsSource="{Binding All}"
                  SelectedItem="{Binding Selected, Mode=TwoWay}" />
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:TextViewModel}">
        <Grid Margin="12">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <TextBlock Text="{Binding PromptText}" />
            <TextBox Grid.Row="1" Text="{Binding Text, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
        </Grid>
    </DataTemplate>
</ResourceDictionary>